---
##
##
### NETBOX_DATA_SOURCE
##
##
- name: "DATA SOURCE 1: Create"
  netbox.netbox.netbox_data_source:
    netbox_url: http://localhost:32768
    netbox_token: "0123456789abcdef0123456789abcdef01234567"
    data:
      name: "Data Source 1"
      type: "local"
      source_url: "/tmp/data-source.txt"
      enabled: true
    state: present
  register: test_one

- name: "DATA SOURCE 1: Assert - Create"
  ansible.builtin.assert:
    that:
      - test_one is changed
      - test_one['diff']['before']['state'] == "absent"
      - test_one['diff']['after']['state'] == "present"
      - test_one['data_source']['name'] == "Data Source 1"
      - test_one['data_source']['type'] == "local"
      - test_one['data_source']['source_url'] == "/tmp/data-source.txt"
      - test_one['data_source']['enabled'] == true
      - test_one['msg'] == "data_source Data Source 1 created"

- name: "DATA SOURCE 2: Update"
  netbox.netbox.netbox_data_source:
    netbox_url: http://localhost:32768
    netbox_token: "0123456789abcdef0123456789abcdef01234567"
    data:
      name: "Data Source 1"
      type: "amazon-s3"
      source_url: "path/to/bucket"
      enabled: false
      description: "My first data source"
      ignore_rules: ".*\nfoo.txt\n*.yml"
      sync_interval: 1440
      comments: "Some commentary on this data source"
    state: present
  register: test_two

- name: "DATA SOURCE 2: Assert - Update"
  ansible.builtin.assert:
    that:
      - test_two is changed
      - test_two['data_source']['name'] == "Data Source 1"
      - test_two['data_source']['type'] == "amazon-s3"
      - test_two['data_source']['source_url'] == "path/to/bucket"
      - test_two['data_source']['enabled'] == false
      - test_two['data_source']['description'] == "My first data source"
      - test_two['data_source']['ignore_rules'] == ".*\nfoo.txt\n*.yml"
      - test_two['data_source']['sync_interval'] == 1440
      - test_two['data_source']['comments'] == "Some commentary on this data source"
      - test_two['msg'] == "data_source Data Source 1 updated"

- name: "DATA SOURCE 3: Delete"
  netbox.netbox.netbox_data_source:
    netbox_url: http://localhost:32768
    netbox_token: "0123456789abcdef0123456789abcdef01234567"
    data:
      name: "Data Source 1"
    state: absent
  register: test_three

- name: "DATA SOURCE 3: Assert - Delete"
  ansible.builtin.assert:
    that:
      - test_three is changed
      - test_three['diff']['before']['state'] == "present"
      - test_three['diff']['after']['state'] == "absent"
